{
  "entities": {
    "Restaurant": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Restaurant",
      "type": "object",
      "description": "Represents a restaurant offering food delivery services.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the restaurant."
        },
        "name": {
          "type": "string",
          "description": "Name of the restaurant."
        },
        "cuisine": {
          "type": "string",
          "description": "Type of cuisine offered by the restaurant (e.g., Italian, Chinese)."
        },
        "rating": {
          "type": "number",
          "description": "Restaurant's average rating (e.g., 4.5 stars)."
        },
        "latitude": {
          "type": "number",
          "description": "Latitude of the restaurant's location."
        },
        "longitude": {
          "type": "number",
          "description": "Longitude of the restaurant's location."
        },
        "openingHours": {
          "type": "string",
          "description": "Restaurant's opening and closing times (e.g., '9:00 AM - 10:00 PM')."
        },
        "kycStatus": {
          "type": "string",
          "description": "Know Your Customer verification status.",
          "enum": ["pending", "verified", "rejected"]
        },
        "menuItemIds": {
          "type": "array",
          "description": "References to MenuItems. (Relationship: Restaurant 1:N MenuItem)",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "name",
        "cuisine",
        "rating",
        "latitude",
        "longitude",
        "openingHours",
        "kycStatus"
      ]
    },
    "MenuCategory": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "MenuCategory",
      "type": "object",
      "description": "Represents a category within a restaurant's menu (e.g., Appetizers, Main Course).",
      "properties": {
        "id": { "type": "string" },
        "restaurantId": { "type": "string" },
        "name": { "type": "string" }
      },
      "required": ["id", "restaurantId", "name"]
    },
    "MenuItem": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "MenuItem",
      "type": "object",
      "description": "Represents a food item on a restaurant's menu.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the menu item."
        },
        "restaurantId": {
          "type": "string",
          "description": "Reference to Restaurant. (Relationship: Restaurant 1:N MenuItem)"
        },
        "categoryId": {
          "type": "string",
          "description": "Reference to MenuCategory."
        },
        "name": {
          "type": "string",
          "description": "Name of the menu item (e.g., Pizza Margherita)."
        },
        "description": {
          "type": "string",
          "description": "Detailed description of the menu item."
        },
        "imageURL": {
          "type": "string",
          "description": "URL of an image of the menu item.",
          "format": "uri"
        },
        "price": {
          "type": "number",
          "description": "Base price of the menu item."
        },
        "availability": {
          "type": "boolean",
          "description": "Indicates whether the menu item is currently available."
        },
        "variants": {
          "type": "array",
          "description": "Different versions of the item (e.g., size, spice level).",
          "items": {
            "type": "object",
            "properties": {
              "name": { "type": "string" },
              "price": { "type": "number" }
            },
            "required": ["name", "price"]
          }
        },
        "addons": {
          "type": "array",
          "description": "Optional extras for the item (e.g., extra cheese, toppings).",
          "items": {
            "type": "object",
            "properties": {
              "name": { "type": "string" },
              "price": { "type": "number" }
            },
            "required": ["name", "price"]
          }
        }
      },
      "required": [
        "id",
        "restaurantId",
        "categoryId",
        "name",
        "description",
        "imageURL",
        "price",
        "availability"
      ]
    },
    "Order": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Order",
      "type": "object",
      "description": "Represents a customer's order.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the order."
        },
        "userId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserProfile 1:N Order)"
        },
        "restaurantId": {
          "type": "string",
          "description": "Reference to Restaurant. (Relationship: Restaurant 1:N Order)"
        },
        "orderDate": {
          "type": "string",
          "description": "Date and time when the order was placed.",
          "format": "date-time"
        },
        "status": {
          "type": "string",
          "description": "Current status of the order (e.g., pending, preparing, out for delivery, delivered)."
        },
        "totalAmount": {
          "type": "number",
          "description": "Total amount of the order."
        },
        "orderItemIds": {
          "type": "array",
          "description": "References to OrderItems. (Relationship: Order 1:N OrderItem)",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "userId",
        "restaurantId",
        "orderDate",
        "status",
        "totalAmount",
        "orderItemIds"
      ]
    },
    "OrderItem": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "OrderItem",
      "type": "object",
      "description": "Represents an item within an order.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the order item."
        },
        "orderId": {
          "type": "string",
          "description": "Reference to Order. (Relationship: Order 1:N OrderItem)"
        },
        "menuItemId": {
          "type": "string",
          "description": "Reference to MenuItem. (Relationship: MenuItem 1:N OrderItem)"
        },
        "quantity": {
          "type": "number",
          "description": "Quantity of the menu item in the order."
        },
        "unitPrice": {
          "type": "number",
          "description": "Price of a single unit of the menu item."
        },
        "subtotal": {
          "type": "number",
          "description": "Total price for this specific item (quantity * unitPrice)."
        }
      },
      "required": [
        "id",
        "orderId",
        "menuItemId",
        "quantity",
        "unitPrice",
        "subtotal"
      ]
    },
    "UserProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserProfile",
      "type": "object",
      "description": "Represents a user's profile information.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user profile."
        },
        "firstName": {
          "type": "string",
          "description": "First name of the user."
        },
        "lastName": {
          "type": "string",
          "description": "Last name of the user."
        },
        "email": {
          "type": "string",
          "description": "Email address of the user.",
          "format": "email"
        },
        "address": {
          "type": "string",
          "description": "User's physical address."
        },
        "phone": {
          "type": "string",
          "description": "User's phone number."
        },
        "orderIds": {
          "type": "array",
          "description": "References to Orders. (Relationship: UserProfile 1:N Order)",
          "items": {
            "type": "string"
          }
        },
        "role": {
          "type": "string",
          "description": "The user's role in the system.",
          "enum": ["customer", "restaurant", "delivery", "admin"]
        }
      },
      "required": [
        "id",
        "firstName",
        "lastName",
        "email",
        "address",
        "phone",
        "orderIds",
        "role"
      ]
    },
    "Offer": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Offer",
      "type": "object",
      "description": "Represents a promotional offer available to users.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the offer."
        },
        "restaurantId": {
          "type": "string",
          "description": "Reference to Restaurant. (Relationship: Restaurant 1:N Offer) Nullable if the offer is not restaurant-specific."
        },
        "description": {
          "type": "string",
          "description": "Description of the offer (e.g., 20% off, free delivery)."
        },
        "discountPercentage": {
          "type": "number",
          "description": "Percentage discount offered (e.g., 0.20 for 20%)."
        },
        "startDate": {
          "type": "string",
          "description": "Date when the offer becomes valid.",
          "format": "date-time"
        },
        "endDate": {
          "type": "string",
          "description": "Date when the offer expires.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "description",
        "discountPercentage",
        "startDate",
        "endDate"
      ]
    },
    "Cart": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Cart",
      "type": "object",
      "description": "Represents a user's shopping cart.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the cart."
        },
        "userId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserProfile 1:1 Cart)"
        },
        "cartItemIds": {
          "type": "array",
          "description": "References to CartItems. (Relationship: Cart 1:N CartItem)",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "userId",
        "cartItemIds"
      ]
    },
    "CartItem": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "CartItem",
      "type": "object",
      "description": "Represents an item within a shopping cart.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the cart item."
        },
        "cartId": {
          "type": "string",
          "description": "Reference to Cart. (Relationship: Cart 1:N CartItem)"
        },
        "menuItemId": {
          "type": "string",
          "description": "Reference to MenuItem. (Relationship: MenuItem 1:N CartItem)"
        },
        "quantity": {
          "type": "number",
          "description": "Quantity of the menu item in the cart."
        }
      },
      "required": [
        "id",
        "cartId",
        "menuItemId",
        "quantity"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous",
      "google.com"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "UserProfile",
          "schema": {
            "$ref": "#/backend/entities/UserProfile"
          },
          "description": "Stores user profiles. Access is restricted to the user themselves.",
          "params": [
            {
              "name": "userId",
              "description": "The unique ID of the user."
            }
          ]
        }
      },
      {
        "path": "/restaurants/{restaurantId}",
        "definition": {
          "entityName": "Restaurant",
          "schema": {
            "$ref": "#/backend/entities/Restaurant"
          },
          "description": "Stores restaurant information.  Publicly readable.",
          "params": [
            {
              "name": "restaurantId",
              "description": "The unique ID of the restaurant."
            }
          ]
        }
      },
       {
        "path": "/restaurants/{restaurantId}/menuCategories/{menuCategoryId}",
        "definition": {
          "entityName": "MenuCategory",
          "schema": {
            "$ref": "#/backend/entities/MenuCategory"
          },
          "description": "Stores menu categories for a restaurant.",
          "params": [
            {
              "name": "restaurantId",
              "description": "The unique ID of the restaurant."
            },
            {
              "name": "menuCategoryId",
              "description": "The unique ID of the menu category."
            }
          ]
        }
      },
      {
        "path": "/restaurants/{restaurantId}/menuItems/{menuItemId}",
        "definition": {
          "entityName": "MenuItem",
          "schema": {
            "$ref": "#/backend/entities/MenuItem"
          },
          "description": "Stores menu items for each restaurant.",
          "params": [
            {
              "name": "restaurantId",
              "description": "The unique ID of the restaurant."
            },
            {
              "name": "menuItemId",
              "description": "The unique ID of the menu item."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/orders/{orderId}",
        "definition": {
          "entityName": "Order",
          "schema": {
            "$ref": "#/backend/entities/Order"
          },
          "description": "Stores orders placed by users. Includes denormalized 'restaurantId' for efficient queries.",
          "params": [
            {
              "name": "userId",
              "description": "The unique ID of the user."
            },
            {
              "name": "orderId",
              "description": "The unique ID of the order."
            }
          ]
        }
      },
      {
        "path": "/offers/{offerId}",
        "definition": {
          "entityName": "Offer",
          "schema": {
            "$ref": "#/backend/entities/Offer"
          },
          "description": "Stores promotional offers. Offers can be restaurant-specific (restaurantId populated) or global.",
          "params": [
            {
              "name": "offerId",
              "description": "The unique ID of the offer."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/carts/{cartId}",
        "definition": {
          "entityName": "Cart",
          "schema": {
            "$ref": "#/backend/entities/Cart"
          },
          "description": "Stores user's shopping carts.",
          "params": [
            {
              "name": "userId",
              "description": "The unique ID of the user."
            },
            {
              "name": "cartId",
              "description": "The unique ID of the cart."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/carts/{cartId}/cartItems/{cartItemId}",
        "definition": {
          "entityName": "CartItem",
          "schema": {
            "$ref": "#/backend/entities/CartItem"
          },
          "description": "Stores items within a user's shopping cart.",
          "params": [
            {
              "name": "userId",
              "description": "The unique ID of the user."
            },
            {
              "name": "cartId",
              "description": "The unique ID of the cart."
            },
            {
              "name": "cartItemId",
              "description": "The unique ID of the cart item."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to support FoodDash's core features, focusing on security, scalability, and ease of debugging. The structure prioritizes authorization independence by denormalizing relevant data to avoid `get()` calls in security rules. \n\nAuthorization Independence and QAPs:\n\n*   User Profiles: User profiles are stored under `/users/{userId}`. Access is restricted to the user themselves, ensuring private data remains protected.\n*   Restaurants: Restaurants are stored in a flat `/restaurants` collection.  Any user can `list` restaurants. Data integrity is enforced through server-side validation.\n*   Menu Items: Menu items are stored under `/restaurants/{restaurantId}/menuItems/{menuItemId}`.  This enforces a natural hierarchy. Authorization is simplified since menu items inherit the restaurant's context.\n*   Orders: Orders are stored under `/users/{userId}/orders/{orderId}`. Only the user can access their orders. The `restaurantId` is denormalized into the order to facilitate queries and reporting.\n*   Cart: Carts are stored under `/users/{userId}/carts/{cartId}`, linking a cart directly to a user. CartItems are stored as a subcollection under `/users/{userId}/carts/{cartId}/cartItems/{cartItemId}`.\n*   Offers: Offers are stored in a flat `/offers` collection. Listing and reading offers is generally public. The `restaurantId` is denormalized, where applicable, to easily filter offers for a specific restaurant.\n\nDenormalization: The `Order` entity denormalizes the `restaurantId` to enable efficient queries for orders related to a specific restaurant without needing to perform a collection group query.  Menu Items store the `restaurantId` to easily query MenuItems for a Restaurant.\n\nStructural Segregation: Each top-level collection (`/users`, `/restaurants`, `/offers`) represents a distinct security context. User-owned data is segregated under their respective user IDs, while restaurant and offer data are stored in separate collections to support different access patterns.\n\nAccess Modeling:\n\n*   Private User Data: User profiles and their associated orders and carts use path-based ownership (`/users/{userId}`).\n*   Collaborative Data: While not explicitly collaborative, if features like shared carts were added, a `members` map within the cart document would be the preferred approach.\n\nExplicit State Modeling: The `Order` entity uses a `status` field to explicitly track the order's state, facilitating clear and predictable logic."
  }
}